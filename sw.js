"use strict";const CACHE_NAME="IvanyBlogHelperCache";let cachelist=[];self.db={read:(e,t)=>(t||(t={type:"text"}),new Promise(((t,n)=>{caches.open(CACHE_NAME).then((n=>{n.match(new Request(`https://LOCALCACHE/${encodeURIComponent(e)}`)).then((function(e){e||t(null),e.text().then((e=>t(e)))})).catch((()=>{t(null)}))}))}))),write:(e,t)=>new Promise(((n,s)=>{caches.open(CACHE_NAME).then((function(s){s.put(new Request(`https://LOCALCACHE/${encodeURIComponent(e)}`),new Response(t)),n()})).catch((()=>{s()}))}))};const set_newest_version=async e=>lfetch(e,e[0]).then((e=>e.json())).then((async e=>{await db.write("blog_version",e.version)}));setInterval((async()=>{await set_newest_version(mirror)}),12e4),setTimeout((async()=>{await set_newest_version(mirror)}),1e3),self.addEventListener("install",(async function(e){self.skipWaiting(),e.waitUntil(caches.open(CACHE_NAME).then((function(e){return console.log("Opened cache"),e.addAll(cachelist)})))})),self.addEventListener("fetch",(async e=>{try{e.respondWith(handle(e.request))}catch(t){e.respondWith(handleerr(e.request,t))}}));const handleerr=async(e,t)=>new Response(`<h1>CDN分流器遇到了致命错误</h1>\n    <b>${t}</b>`,{headers:{"content-type":"text/html; charset=utf-8"}}),lfetch=async(e,t)=>{let n=new AbortController;const s=async e=>new Response(await e.arrayBuffer(),{status:e.status,headers:e.headers});return Promise.any||(Promise.any=function(e){return new Promise(((t,n)=>{let s=(e=Array.isArray(e)?e:[]).length,r=[];if(0===s)return n(new AggregateError("All promises were rejected"));e.forEach((e=>{e.then((e=>{t(e)}),(e=>{s--,r.push(e),0===s&&n(new AggregateError(r))}))}))}))}),Promise.any(e.map((e=>new Promise(((t,r)=>{fetch(e,{signal:n.signal}).then(s).then((e=>{200==e.status?(n.abort(),t(e)):r(e)}))})))))};self.addEventListener("activate",(function(e){e.waitUntil(caches.keys().then((function(e){return Promise.all(e.filter((function(e){return e.startsWith("butterfly-")&&e!==CACHE_NAME})).map((function(e){return caches.delete(e)})))})))})),self.addEventListener("fetch",(async e=>{e.respondWith(caches.match(e.request).then((function(t){return t||fetch(e.request).then((function(e){return 404===e.status?fetch("/404.html"):e}))}))),e.respondWith(handle(e.request))}));const fullpath=e=>((e=e.split("?")[0].split("#")[0]).match(/\/$/)&&(e+="index"),e.match(/\.[a-zA-Z]+$/)||(e+=".html"),e),generate_blog_urls=(e,t,n)=>{const s=["https://ivany.s3.ladydaily.com"];for(var r in s)s[r]+=n;return s},mirror=[],get_newest_version=async e=>lfetch(e,e[0]).then((e=>e.json())).then(res.version),handle=async e=>{const t=e.url,n=new URL(t),s=n.pathname;return"blog.ivany.xyz"===n.hostname?lfetch(["https://ivany.s3.ladydaily.com"+(r=s,(r=r.split("?")[0].split("#")[0]).match(/\/$/)&&(r+="index"),r.match(/\.[a-zA-Z]+$/)||(r+=".html"),r)]):fetch(e);var r};var workboxVersion="5.1.3";importScripts("https://storage.googleapis.com/workbox-cdn/releases/".concat(workboxVersion,"/workbox-sw.js")),workbox.core.setCacheNameDetails({prefix:"ivany"}),workbox.core.skipWaiting(),workbox.core.clientsClaim(),workbox.precaching.precacheAndRoute([{revision:"25a9ab1fb151b910195900135b3e429a",url:"./404.html"},{revision:"6087de5cbf0ab658e85cfffb713c7047",url:"./index.html"},{revision:"826901386143ce061cd89863a06b1f88",url:"./js/main.js"},{revision:"f709c236467fcd82111d9077996bbe4d",url:"./js/custom.js"},{revision:"884d95e4590f231245d4b264d9e30214",url:"./css/index.css"},{revision:"1e9b67c29edc691daa0c93b3ee412046",url:"./css/custom.css"},{revision:"4ef3cfb882b6dd4128da4c8745e9a507",url:"./img/404.jpg"},{revision:"b40efd6c0e10a7caba084c711d76e310",url:"./img/footer/CDN-jsDelivr-orange.svg"},{revision:"77f0a6d80f5b049ecd8377de31fff3d9",url:"./img/footer/Copyright-BY--NC--SA 4.svg"},{revision:"4c529e432a05854034c8120c20d9812c",url:"./img/footer/Frame-Hexo-blue.svg"},{revision:"8be4fd87389c3bd65ae9a0697dc270db",url:"./img/footer/ivany-摸鱼中.svg"},{revision:"2933868d1a9cfd80ade8f4ea95e806e8",url:"./img/footer/ivany-晚安呐.svg"},{revision:"e5e8dcc2c4a69afadd03731e00b8deec",url:"./img/footer/moe.svg"},{revision:"c7d5c1efd84c41246fc809a44e4e0a2e",url:"./img/footer/Source-Github-d021d6.svg"},{revision:"973244a3db55c1dcdd9f158158082cd5",url:"./img/footer/Theme-Butterfly-6513df.svg"},{revision:"e774b052e6b1a2f5f716c6bf71222af2",url:"./img/footer/vercel.svg"},{revision:"d5d51c0c23a6fe6b5e445939044e6b65",url:"./img/error/friend_404.gif"}],{directoryIndex:null}),workbox.precaching.cleanupOutdatedCaches(),workbox.routing.registerRoute(/\.(?:png|jpg|jpeg|gif|bmp|webp|svg|ico)$/,new workbox.strategies.CacheFirst({cacheName:"images",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:1e3,maxAgeSeconds:2592e3}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})]})),workbox.routing.registerRoute(/\.(?:eot|ttf|woff|woff2)$/,new workbox.strategies.CacheFirst({cacheName:"fonts",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:1e3,maxAgeSeconds:2592e3}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})]})),workbox.routing.registerRoute(/^https:\/\/fonts\.googleapis\.com/,new workbox.strategies.StaleWhileRevalidate({cacheName:"google-fonts-stylesheets"})),workbox.routing.registerRoute(/^https:\/\/fonts\.gstatic\.com/,new workbox.strategies.CacheFirst({cacheName:"google-fonts-webfonts",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:1e3,maxAgeSeconds:2592e3}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})]})),workbox.googleAnalytics.initialize();